<div class="w-full flex flex-col mt-4">

  <!-- Logo de la categoría -->


  <!-- Breadcrumb -->
  <h2 class="text-2xl font-bold ml-[7.5rem] mt-4">
    <a routerLink="/categories">PRODUCTOS/</a>
    <a [routerLink]="['/category', product?.categoria]" class="text-secundario">{{ product?.categoria?.toUpperCase()
      }}</a>
  </h2>

  <!-- Main content -->
  <ng-container *ngIf="loading; else productDetail">
    <div class="flex flex-col lg:flex-row items-start justify-center gap-10 mt-10 animate-pulse">

      <!-- Skeleton imagen -->

      <div class="h-[55vh] w-auto object-contain rounded-xl bg-red-50"></div>


      <!-- Skeleton card -->
      <div class="bg-gray-100/70 p-10 rounded-2xl max-w-3xl w-full">
        <!-- título -->
        <div class="h-8 w-3/4 bg-gray-200 rounded mx-auto mb-6"></div>

        <!-- descripción (3 líneas) -->
        <div class="space-y-3">
          <div class="h-4 w-full bg-gray-200 rounded"></div>
          <div class="h-4 w-11/12 bg-gray-200 rounded"></div>
          <div class="h-4 w-10/12 bg-gray-200 rounded"></div>
        </div>
        <!-- botón ver más -->
        <div class="h-8 w-24 bg-gray-200 rounded mt-4"></div>

        <!-- opciones (2 grupos de ejemplo) -->
        <div class="mt-8 space-y-6">
          <div class="flex items-center gap-4">
            <div class="h-5 w-28 bg-gray-200 rounded"></div>
            <div class="flex items-center gap-3">
              <div class="size-6 rounded-full bg-gray-200 border"></div>
              <div class="size-6 rounded-full bg-gray-200 border"></div>
              <div class="size-6 rounded-full bg-gray-200 border"></div>
            </div>
          </div>
          <div class="flex items-center gap-4">
            <div class="h-5 w-28 bg-gray-200 rounded"></div>
            <div class="flex items-center gap-3">
              <div class="h-8 px-6 rounded-full bg-gray-200"></div>
              <div class="h-8 px-10 rounded-full bg-gray-200"></div>
              <div class="h-8 px-8 rounded-full bg-gray-200"></div>
            </div>
          </div>
        </div>

        <!-- precio -->
        <div class="h-7 w-40 bg-gray-200 rounded mx-auto my-8"></div>

        <!-- CTA -->
        <div class="flex justify-center">
          <div class="h-12 w-56 bg-gray-200 rounded-lg"></div>
        </div>
      </div>
    </div>
  </ng-container>
  <ng-template #productDetail>
    <div class="flex flex-col lg:flex-row items-start justify-center gap-10 mt-10">

      <!-- Imagen principal -->
      <!-- Logo + breadcrumb iguales a antes -->

      <!-- Imagen principal -->
      <img [src]="product?.imagen || 'assets/placeholder.png'" [alt]="product?.nombre"
        class="h-[55vh] w-auto object-contain rounded-xl" />

      <!-- Card -->
      <div class="bg-gray-200 p-10 rounded-2xl max-w-3xl w-full">

        <h1 class="text-4xl text-principal font-bold text-center mb-4">
          {{ product?.nombre }}
        </h1>
        <p class="text-principal font-light text-lg leading-relaxed text-justify">
          {{ product?.descripcion?.substring(0, showMore ? undefined : 200) }}<span
            *ngIf="showMore === false">...</span>
        </p>
        <button *ngIf="showMore !== null" (click)="viewMore()"
          class="bg-secundario text-white px-2 py-1 rounded-md font-semibold mt-2">
          {{ showMore ? 'Ver menos' : 'Ver más' }}
        </button>

        <!-- Opciones dinámicas -->
        <div class="mt-8 space-y-6">
          <div *ngFor="let opt of options" class="flex items-center">
            <span class="font-semibold text-lg text-principal mr-4">{{ opt.name }}:</span>

            <div class="flex items-center gap-3" *ngIf="opt.name | lowercase as ln">
              <!-- Si parece color, usa circulitos; si no, pills con texto -->
              <ng-container *ngFor="let val of opt.values">
                <!-- swatch circular (intenta pintar color; si no, igual muestra borde) -->
                <button *ngIf="ln === 'color'; else textValue" [title]="val"
                  class="w-6 h-6 rounded-full border-2 transition" [ngStyle]="colorSwatchStyle(val)" [ngClass]="{
              'border-secundario ring-2 ring-principal': selected[keyize(opt.name)] === val,
              'opacity-40 pointer-events-none': isDisabled(opt.name, val)
            }" (click)="!isDisabled(opt.name, val) && select(opt.name, val)"></button>

                <!-- texto -->
                <ng-template #textValue>
                  <button class="px-3 h-8 rounded-full border-2 transition" [ngClass]="{
                'border-secundario bg-white': selected[keyize(opt.name)] === val,
                'border-gray-400 hover:border-secundario': selected[keyize(opt.name)] !== val,
                'opacity-40 pointer-events-none': isDisabled(opt.name, val)
              }" (click)="!isDisabled(opt.name, val) && select(opt.name, val)">
                    {{ val }}
                  </button>
                </ng-template>
              </ng-container>
            </div>
          </div>
        </div>

        <!-- Precio (variante si ya hay una única, sino base) -->
        <p class="text-2xl font-bold text-secundario text-center my-8">
          USD$ {{ (displayPrice || (product?.precio_base??0)*1.15) | currency:'':'symbol':'1.2-2' }}
        </p>

        <div class="flex gap-6 justify-center">
          <button class="bg-secundario hover:bg-yellow-600 text-white font-bold py-3 px-8 rounded-lg transition"
            (click)="addToCart()">
            AÑADIR AL CARRITO
          </button>
        </div>
      </div>
    </div>
  </ng-template>

</div>